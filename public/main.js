var eia=function(){const LOADED_SCRIPTS=new Set,LOADED_STYLES=new Set,markers=new Map;let locations=null,mapboxToken=null,Mapbox=null,debugMode=!1,filterStandards=new Set,filterTags=new Set;function setLocations(locs){locations=locs}function setMapboxToken(token){mapboxToken=token}function filterLocations(){locations.forEach((location)=>{const marker=markers.get(location.Slug),hasStandard=filterStandards.size===0||filterStandards.has(location.Standard),hasTags=filterTags.size===0||location.Tags.some((tag)=>filterTags.has(tag));if(hasStandard&&hasTags)marker.addTo(Mapbox);else marker.remove()})}function waitForLibrary(lib,callback,timeout){if(window[lib]){if(debugMode)console.debug(`${lib} is available`);callback()}else console.warn(`${lib} is not available yet, waiting...`),setTimeout(()=>{waitForLibrary(lib,callback)},timeout)}function documentReady(fn){document.addEventListener("DOMContentLoaded",()=>{if(document.readyState==="interactive"||document.readyState==="complete"){if(debugMode)console.debug("Document is ready");fn()}})}function isValidURL(url){try{return new URL(url),!0}catch(e){return!1}}function injectJS(url){if(!isValidURL(url)){console.error("Invalid URL:",url);return}if(debugMode)console.debug("Injecting library:",url);if(LOADED_SCRIPTS.has(url)){console.warn("Library already loaded, skipping:",url);return}const script=document.createElement("script");script.type="text/javascript",script.src=url,document.head.appendChild(script),LOADED_SCRIPTS.add(url)}function injectCSS(url){if(!isValidURL(url)){console.error("Invalid URL:",url);return}if(debugMode)console.debug("Injecting CSS:",url);if(LOADED_STYLES.has(url)){console.warn("CSS already loaded, skipping:",url);return}const link=document.createElement("link");link.rel="stylesheet",link.href=url,document.head.appendChild(link),LOADED_STYLES.add(url)}function addMapLocations(){locations.forEach((location)=>{const isPatagonia=location.Tags.includes("patagonia")?"patagonia":"",marker=new mapboxgl.Marker().setLngLat([location.Lat,location.Lng]).setPopup(new mapboxgl.Popup().setHTML(`
          <div class="location-popup flex flex-col ${location.Standard} ${isPatagonia}">
            ${location.Image?`<div class="location-popup-image" style="background-image: url(\'/public/images/${location.Slug}-popup.jpg\')"></div>`:""}
            <div class="location-popup-content">
              <ul class="tags">
                ${location.Tags.map((tag)=>`<li class="tag">${util.renderTagIcon(tag)}</li>`).join("")}
              </ul>
              <h3>${location.Name}</h3>
              <p>${location.Description}</p>
              <a class="outline-none button button-outline" href="/locations/${location.Slug}" target="_blank">Explore</a>
            </div>
          </div>
        `));markers.set(location.Slug,marker)}),filterLocations()}function renderHomeMap(){mapboxgl.accessToken=mapboxToken,Mapbox=new mapboxgl.Map({attributionControl:!1,compact:!0,container:"map",style:"mapbox://styles/mapbox/outdoors-v12",center:[-98.5556199,39.8097343],zoom:2,minZoom:2,maxZoom:12,cooperativeGestures:!0}),Mapbox.on("load",()=>{addMapLocations(),initFilterListeners()})}function initFilterListeners(){const standardFilters=document.querySelectorAll("#filter-standards .checkbox input"),tagFilters=document.querySelectorAll("#filter-tags .checkbox input");standardFilters.forEach((filter)=>{filterStandards.add(filter.value),filter.addEventListener("change",function(){const standard=this.value;if(this.checked)filterStandards.add(standard);else filterStandards.delete(standard);filterLocations()})}),tagFilters.forEach((filter)=>{filterTags.add(filter.value),filter.addEventListener("change",function(){const tag=this.value;if(this.checked)filterTags.add(tag);else filterTags.delete(tag);filterLocations()})})}function initMapbox(){if(!document.getElementById("map"))return;if(!mapboxToken){console.error("Mapbox token is missing");return}if(!locations){console.error("Locations object is missing");return}injectCSS("https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css"),injectJS("https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"),waitForLibrary("mapboxgl",()=>{renderHomeMap()},200)}function init(opts={}){if(opts.debug)debugMode=!0;initMapbox()}return{init,setLocations,setMapboxToken}}();
